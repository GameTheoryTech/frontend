{"version":3,"sources":["hooks/useBondStats.ts","components/PageHeader/PageHeader.tsx","views/Pit/components/ExchangeModal.tsx","hooks/useCatchError.ts","views/Pit/components/ExchangeCard.tsx","hooks/useCashPriceInLastTWAP.ts","views/Pit/components/ExchangeStat.tsx","hooks/useBondsPurchasable.ts","tomb-finance/constants.ts","views/Pit/Pit.tsx"],"names":["useBondStats","useState","stat","setStat","slowRefresh","useRefresh","tombFinance","useTombFinance","useEffect","a","getBondStat","console","error","fetchBondPrice","StyledPageHeader","styled","div","props","theme","spacing","StyledTitle","h1","color","grey","StyledSubtitle","h3","PageHeader","icon","subtitle","title","ExchangeModal","max","description","onConfirm","onDismiss","action","tokenName","val","setVal","fullBalance","useMemo","getFullDisplayBalance","handleChange","useCallback","e","currentTarget","value","handleSelectMax","Modal","ModalTitle","text","TokenInput","onSelectMax","onChange","symbol","Label","ModalActions","variant","onClick","DEFAULT_ERROR_MSG","useCatchError","addPopup","useAddPopup","promise","message","catch","err","includes","stack","StyledCardTitle","StyledCardIcon","StyledExchanger","StyledExchangeArrow","StyledToken","StyledCardActions","StyledDesc","span","StyledCardContentInner","ExchangeCard","fromToken","fromTokenName","toToken","toTokenName","priceDesc","onExchange","disabled","disabledDescription","undefined","catchError","Treasury","contracts","useApprove","address","approveStatus","approve","balance","useTokenBalance","useModal","gt","onPresent","Card","CardContent","style","background","TokenSymbol","size","faArrowRight","ApprovalState","APPROVED","Button","PENDING","UNKNOWN","useCashPriceInLastTWAP","BigNumber","from","price","setPrice","fetchCashPrice","getTombPriceInLastTWAP","refreshInterval","setInterval","config","clearInterval","ExchangeStat","useBondsPurchasable","setBalance","getBondsPurchasable","fetchBondsPurchasable","DECIMALS_18","pow","BOND_REDEEM_PRICE_BN","mul","BackgroundImage","createGlobalStyle","StyledBond","StyledCardWrapper","StyledStatsWrapper","Pit","path","useRouteMatch","account","useWallet","addTransaction","useTransactionAdder","bondStat","cashPrice","bondsPurchasable","rebateStats","useTreasury","bondBalance","HODL","handleBuyBonds","amount","buyBonds","tx","summary","Number","toFixed","handleRedeemBonds","redeemBonds","isBondRedeemable","isBondPurchasable","tokenInFtm","Page","Typography","align","gutterBottom","exact","TOMB","getDisplayBalance","Spacer","tombAvailable","maxBondSell","bondBonus","eq","maxBondSellBN","UnlockWallet"],"mappings":"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","file":"static/js/21.8d4487cd.chunk.js","sourcesContent":["import { useEffect, useState } from 'react';\r\nimport useTombFinance from './useTombFinance';\r\nimport { TokenStat } from '../tomb-finance/types';\r\nimport useRefresh from './useRefresh';\r\n\r\nconst useBondStats = () => {\r\n  const [stat, setStat] = useState<TokenStat>();\r\n  const { slowRefresh } = useRefresh();\r\n  const tombFinance = useTombFinance();\r\n\r\n  useEffect(() => {\r\n    async function fetchBondPrice() {\r\n      try {\r\n        setStat(await tombFinance.getBondStat());\r\n      }\r\n      catch(err){\r\n        console.error(err);\r\n      }\r\n    }\r\n    fetchBondPrice();\r\n  }, [setStat, tombFinance, slowRefresh]);\r\n\r\n  return stat;\r\n};\r\n\r\nexport default useBondStats;\r\n","import React from 'react';\r\nimport styled from 'styled-components';\r\n\r\ninterface PageHeaderProps {\r\n  icon: React.ReactNode;\r\n  subtitle?: string;\r\n  title?: string;\r\n}\r\n\r\nconst PageHeader: React.FC<PageHeaderProps> = ({ icon, subtitle, title }) => {\r\n  return (\r\n    <StyledPageHeader>\r\n      {/* <StyledIcon>{icon}</StyledIcon> */}\r\n      <StyledTitle>{title}</StyledTitle>\r\n      <StyledSubtitle>{subtitle}</StyledSubtitle>\r\n    </StyledPageHeader>\r\n  );\r\n};\r\n\r\nconst StyledPageHeader = styled.div`\r\n  align-items: center;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding-bottom: ${(props) => props.theme.spacing[6]}px;\r\n  padding-top: ${(props) => props.theme.spacing[6]}px;\r\n  max-width: 610px;\r\n  width: 100%;\r\n  margin: 0 auto;\r\n  text-align: center;\r\n`;\r\n\r\nconst StyledTitle = styled.h1`\r\n  color: ${(props) => props.theme.color.grey[100]};\r\n  font-size: 36px;\r\n  font-weight: 700;\r\n  margin: 0;\r\n  padding: 0;\r\n`;\r\n\r\nconst StyledSubtitle = styled.h3`\r\n  color: ${(props) => props.theme.color.grey[400]};\r\n  font-size: 18px;\r\n  font-weight: 400;\r\n  margin: 0;\r\n  padding: 0;\r\n  text-align: center;\r\n`;\r\n\r\nexport default PageHeader;\r\n","import React, { useCallback, useMemo, useState } from 'react';\r\nimport Button from '../../../components/Button';\r\nimport Modal, { ModalProps } from '../../../components/Modal';\r\nimport ModalActions from '../../../components/ModalActions';\r\nimport ModalTitle from '../../../components/ModalTitle';\r\nimport TokenInput from '../../../components/TokenInput';\r\nimport { getFullDisplayBalance } from '../../../utils/formatBalance';\r\nimport { BigNumber } from 'ethers';\r\nimport Label from '../../../components/Label';\r\n\r\ninterface ExchangeModalProps extends ModalProps {\r\n  max: BigNumber;\r\n  onConfirm: (amount: string) => void;\r\n  title: string;\r\n  description: string;\r\n  action: string;\r\n  tokenName: string;\r\n}\r\n\r\nconst ExchangeModal: React.FC<ExchangeModalProps> = ({\r\n  max,\r\n  title,\r\n  description,\r\n  onConfirm,\r\n  onDismiss,\r\n  action,\r\n  tokenName,\r\n}) => {\r\n  const [val, setVal] = useState('');\r\n  const fullBalance = useMemo(() => getFullDisplayBalance(max), [max]);\r\n\r\n  const handleChange = useCallback((e: React.FormEvent<HTMLInputElement>) => setVal(e.currentTarget.value), [setVal]);\r\n\r\n  const handleSelectMax = useCallback(() => {\r\n    setVal(fullBalance);\r\n  }, [fullBalance, setVal]);\r\n\r\n  return (\r\n    <Modal>\r\n      <ModalTitle text={title} />\r\n      <TokenInput\r\n        value={val}\r\n        onSelectMax={handleSelectMax}\r\n        onChange={handleChange}\r\n        max={fullBalance}\r\n        symbol={tokenName}\r\n      />\r\n      <Label text={description} />\r\n      <ModalActions>\r\n        <Button text=\"Cancel\" variant=\"secondary\" onClick={onDismiss} />\r\n        <Button text={action} onClick={() => onConfirm(val)} />\r\n      </ModalActions>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ExchangeModal;\r\n","import { useCallback } from 'react';\r\nimport { useAddPopup } from '../state/application/hooks';\r\n\r\nconst DEFAULT_ERROR_MSG = 'Unexpected error is occurred.';\r\n\r\nfunction useCatchError(): (promise: Promise<any>, message?: string) => void {\r\n  const addPopup = useAddPopup();\r\n\r\n  return useCallback(\r\n    (promise: Promise<any>, message = DEFAULT_ERROR_MSG) => {\r\n      promise.catch((err) => {\r\n        if (err.message.includes('User denied')) {\r\n          // User denied transaction signature on MetaMask.\r\n          return;\r\n        }\r\n        console.error(`Uncaught exception: ${err.stack}`);\r\n        addPopup({ error: { message, stack: err.stack } });\r\n      });\r\n    },\r\n    [addPopup],\r\n  );\r\n}\r\n\r\nexport default useCatchError;\r\n","import React from 'react';\r\nimport styled from 'styled-components';\r\n\r\nimport { Button, Card } from '@mui/material';\r\n\r\n// import Button from '../../../components/Button';\r\n// import Card from '../../../components/Card';\r\nimport CardContent from '../../../components/CardContent';\r\nimport useTombFinance from '../../../hooks/useTombFinance';\r\nimport Label from '../../../components/Label';\r\nimport TokenSymbol from '../../../components/TokenSymbol';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome/index';\r\nimport { faArrowRight } from '@fortawesome/free-solid-svg-icons/index';\r\nimport useModal from '../../../hooks/useModal';\r\nimport ExchangeModal from './ExchangeModal';\r\nimport ERC20 from '../../../tomb-finance/ERC20';\r\nimport useTokenBalance from '../../../hooks/useTokenBalance';\r\nimport useApprove, { ApprovalState } from '../../../hooks/useApprove';\r\nimport useCatchError from '../../../hooks/useCatchError';\r\nimport {BigNumber} from \"ethers\";\r\n\r\ninterface ExchangeCardProps {\r\n  action: string;\r\n  fromToken: ERC20;\r\n  fromTokenName: string;\r\n  toToken: ERC20;\r\n  toTokenName: string;\r\n  priceDesc: string;\r\n  onExchange: (amount: string) => void;\r\n  disabled?: boolean;\r\n  disabledDescription?: string;\r\n  max?: BigNumber;\r\n}\r\n\r\nconst ExchangeCard: React.FC<ExchangeCardProps> = ({\r\n  action,\r\n  fromToken,\r\n  fromTokenName,\r\n  toToken,\r\n  toTokenName,\r\n  priceDesc,\r\n  onExchange,\r\n  disabled = false,\r\n  disabledDescription,\r\n  max = undefined\r\n}) => {\r\n  const catchError = useCatchError();\r\n  const {\r\n    contracts: { Treasury },\r\n  } = useTombFinance();\r\n  const [approveStatus, approve] = useApprove(fromToken, Treasury.address);\r\n  const balance = useTokenBalance(fromToken);\r\n  const [onPresent, onDismiss] = useModal(\r\n    <ExchangeModal\r\n      title={action}\r\n      description={priceDesc}\r\n      max={max == undefined ? balance : (balance.gt(max) ? max : balance)}\r\n      onConfirm={(value) => {\r\n        onExchange(value);\r\n        onDismiss();\r\n      }}\r\n      action={action}\r\n      tokenName={fromTokenName}\r\n    />,\r\n  );\r\n  return (\r\n    <Card>\r\n      <CardContent>\r\n        <StyledCardContentInner>\r\n          <StyledCardTitle>{`${action} ${toTokenName}`}</StyledCardTitle>\r\n          <StyledExchanger>\r\n            <StyledToken>\r\n              <StyledCardIcon style={{ background: 'transparent' }}>\r\n                <TokenSymbol symbol={fromToken.symbol} size={54}/>\r\n              </StyledCardIcon>\r\n              <Label text={fromTokenName} variant=\"normal\" />\r\n            </StyledToken>\r\n            <StyledExchangeArrow>\r\n              <FontAwesomeIcon icon={faArrowRight} />\r\n            </StyledExchangeArrow>\r\n            <StyledToken>\r\n              <StyledCardIcon style={{ background: 'transparent' }}>\r\n                <TokenSymbol symbol={toToken.symbol} size={54} />\r\n              </StyledCardIcon>\r\n              <Label text={toTokenName} variant=\"normal\" />\r\n            </StyledToken>\r\n          </StyledExchanger>\r\n          <StyledDesc>{priceDesc}</StyledDesc>\r\n          <StyledCardActions>\r\n            {approveStatus !== ApprovalState.APPROVED && !disabled ? (\r\n              <Button\r\n                color=\"primary\"\r\n                variant=\"contained\"\r\n                disabled={approveStatus === ApprovalState.PENDING || approveStatus === ApprovalState.UNKNOWN}\r\n                onClick={() => catchError(approve(), `Unable to approve ${fromTokenName}`)}\r\n              >\r\n                {`Approve ${fromTokenName}`}\r\n              </Button>\r\n            ) : (\r\n              <Button color=\"primary\" variant=\"contained\" onClick={onPresent} disabled={disabled}>\r\n                {disabledDescription || action}\r\n              </Button>\r\n            )}\r\n          </StyledCardActions>\r\n        </StyledCardContentInner>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nconst StyledCardTitle = styled.div`\r\n  align-items: center;\r\n  display: flex;\r\n  font-size: 20px;\r\n  font-weight: 700;\r\n  height: 64px;\r\n  justify-content: center;\r\n  margin-top: ${(props) => -props.theme.spacing[3]}px;\r\n`;\r\n\r\nconst StyledCardIcon = styled.div`\r\n  background-color: ${(props) => props.theme.color.grey[900]};\r\n  width: 72px;\r\n  height: 72px;\r\n  border-radius: 36px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  margin-bottom: ${(props) => props.theme.spacing[2]}px;\r\n`;\r\n\r\nconst StyledExchanger = styled.div`\r\n  align-items: center;\r\n  display: flex;\r\n  margin-bottom: ${(props) => props.theme.spacing[5]}px;\r\n`;\r\n\r\nconst StyledExchangeArrow = styled.div`\r\n  font-size: 20px;\r\n  padding-left: ${(props) => props.theme.spacing[3]}px;\r\n  padding-right: ${(props) => props.theme.spacing[3]}px;\r\n  padding-bottom: ${(props) => props.theme.spacing[4]}px;\r\n`;\r\n\r\nconst StyledToken = styled.div`\r\n  align-items: center;\r\n  display: flex;\r\n  flex-direction: column;\r\n  font-weight: 600;\r\n`;\r\n\r\nconst StyledCardActions = styled.div`\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-top: ${(props) => props.theme.spacing[3]}px;\r\n  width: 100%;\r\n`;\r\n\r\nconst StyledDesc = styled.span``;\r\n\r\nconst StyledCardContentInner = styled.div`\r\n  align-items: center;\r\n  display: flex;\r\n  flex: 1;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n`;\r\n\r\nexport default ExchangeCard;\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport useTombFinance from './useTombFinance';\r\nimport config from '../config';\r\nimport { BigNumber } from 'ethers';\r\n\r\nconst useCashPriceInLastTWAP = () => {\r\n  const [price, setPrice] = useState<BigNumber>(BigNumber.from(0));\r\n  const tombFinance = useTombFinance();\r\n\r\n  const fetchCashPrice = useCallback(async () => {\r\n    setPrice(await tombFinance.getTombPriceInLastTWAP());\r\n  }, [tombFinance]);\r\n\r\n  useEffect(() => {\r\n    fetchCashPrice().catch((err) => console.error(`Failed to fetch TOMB price: ${err.stack}`));\r\n    const refreshInterval = setInterval(fetchCashPrice, config.refreshInterval);\r\n    return () => clearInterval(refreshInterval);\r\n  }, [setPrice, tombFinance, fetchCashPrice]);\r\n\r\n  return price;\r\n};\r\n\r\nexport default useCashPriceInLastTWAP;\r\n","import React from 'react';\r\nimport styled from 'styled-components';\r\n\r\nimport { Card } from '@mui/material';\r\n\r\ninterface ExchangeStatProps {\r\n  tokenName: string;\r\n  description: string;\r\n  price: string;\r\n}\r\n\r\nconst ExchangeStat: React.FC<ExchangeStatProps> = ({ tokenName, description, price }) => {\r\n  return (\r\n    <Card>\r\n      <StyledCardContentInner>\r\n        <StyledCardTitle>{`💰 ${tokenName} = ${price} DAI`}</StyledCardTitle>\r\n        <StyledDesc>{description}</StyledDesc>\r\n      </StyledCardContentInner>\r\n    </Card>\r\n  );\r\n};\r\n\r\nconst StyledCardTitle = styled.div`\r\n  font-size: 20px;\r\n  font-weight: 700;\r\n  margin-bottom: ${(props) => props.theme.spacing[2]}px;\r\n`;\r\n\r\nconst StyledDesc = styled.span`\r\n  //color: ${(props) => props.theme.color.grey[300]};\r\n  text-align: center;\r\n`;\r\n\r\nconst StyledCardContentInner = styled.div`\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n  padding: ${(props) => props.theme.spacing[2]}px;\r\n`;\r\n\r\nexport default ExchangeStat;\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport { BigNumber } from 'ethers';\r\nimport ERC20 from '../tomb-finance/ERC20';\r\nimport useTombFinance from './useTombFinance';\r\nimport config from '../config';\r\n\r\nconst useBondsPurchasable = () => {\r\n  const [balance, setBalance] = useState(BigNumber.from(0));\r\n  const tombFinance = useTombFinance();\r\n\r\n  useEffect(() => {\r\n    async function fetchBondsPurchasable() {\r\n        try {\r\n            setBalance(await tombFinance.getBondsPurchasable());\r\n        }\r\n        catch(err) {\r\n            console.error(err);\r\n        }\r\n      }\r\n    fetchBondsPurchasable();\r\n  }, [setBalance, tombFinance]);\r\n\r\n  return balance;\r\n};\r\n\r\nexport default useBondsPurchasable;\r\n","import { BigNumber } from 'ethers';\r\n\r\nexport const DECIMALS_18 = BigNumber.from(10).pow(18);\r\n\r\nexport const BOND_REDEEM_PRICE = 1.01;\r\nexport const BOND_REDEEM_PRICE_BN = DECIMALS_18.mul(101).div(100);\r\n","import React, { useCallback, useMemo } from 'react';\r\nimport Page from '../../components/Page';\r\nimport PitImage from '../../assets/img/pit.png';\r\nimport { createGlobalStyle } from 'styled-components';\r\nimport { Route, Switch, useRouteMatch } from 'react-router-dom';\r\nimport { useWallet } from 'use-wallet';\r\nimport UnlockWallet from '../../components/UnlockWallet';\r\nimport PageHeader from '../../components/PageHeader';\r\nimport ExchangeCard from './components/ExchangeCard';\r\nimport styled from 'styled-components';\r\nimport Spacer from '../../components/Spacer';\r\nimport useBondStats from '../../hooks/useBondStats';\r\nimport useTombFinance from '../../hooks/useTombFinance';\r\nimport useCashPriceInLastTWAP from '../../hooks/useCashPriceInLastTWAP';\r\nimport { useTransactionAdder } from '../../state/transactions/hooks';\r\nimport ExchangeStat from './components/ExchangeStat';\r\nimport useTokenBalance from '../../hooks/useTokenBalance';\r\nimport useBondsPurchasable from '../../hooks/useBondsPurchasable';\r\nimport { getDisplayBalance } from '../../utils/formatBalance';\r\nimport { BOND_REDEEM_PRICE, BOND_REDEEM_PRICE_BN } from '../../tomb-finance/constants';\r\nimport { Typography } from '@mui/material';\r\nimport useRefresh from \"../../hooks/useRefresh\";\r\nimport useTreasury from \"../../hooks/useTreasury\";\r\n\r\n\r\nconst BackgroundImage = createGlobalStyle`\r\n  body {\r\n    background-color: var(--black);\r\n    background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='32' viewBox='0 0 16 32'%3E%3Cg fill='%231D1E1F' fill-opacity='0.4'%3E%3Cpath fill-rule='evenodd' d='M0 24h4v2H0v-2zm0 4h6v2H0v-2zm0-8h2v2H0v-2zM0 0h4v2H0V0zm0 4h2v2H0V4zm16 20h-6v2h6v-2zm0 4H8v2h8v-2zm0-8h-4v2h4v-2zm0-20h-6v2h6V0zm0 4h-4v2h4V4zm-2 12h2v2h-2v-2zm0-8h2v2h-2V8zM2 8h10v2H2V8zm0 8h10v2H2v-2zm-2-4h14v2H0v-2zm4-8h6v2H4V4zm0 16h6v2H4v-2zM6 0h2v2H6V0zm0 24h2v2H6v-2z'/%3E%3C/g%3E%3C/svg%3E\");\r\n}\r\n\r\n* {\r\n    background: transparent;\r\n    border-radius: 0 !important;\r\n    box-shadow: none !important;\r\n}\r\n`;\r\n\r\nconst Pit: React.FC = () => {\r\n  const { path } = useRouteMatch();\r\n  const { account } = useWallet();\r\n  const tombFinance = useTombFinance();\r\n  const addTransaction = useTransactionAdder();\r\n  const bondStat = useBondStats();\r\n  const cashPrice = useCashPriceInLastTWAP();\r\n  const bondsPurchasable = useBondsPurchasable();\r\n  const rebateStats = useTreasury();\r\n  const  { slowRefresh } = useRefresh();\r\n\r\n  const bondBalance = useTokenBalance(tombFinance?.HODL);\r\n\r\n  const handleBuyBonds = useCallback(\r\n    async (amount: string) => {\r\n      const tx = await tombFinance.buyBonds(amount);\r\n      addTransaction(tx, {\r\n        summary: `Buy ${Number(amount).toFixed(2)} HODL with ${amount} TOMB`,\r\n      });\r\n    },\r\n    [tombFinance, addTransaction],\r\n  );\r\n\r\n  const handleRedeemBonds = useCallback(\r\n    async (amount: string) => {\r\n      const tx = await tombFinance.redeemBonds(amount);\r\n      addTransaction(tx, { summary: `Redeem ${amount} HODL` });\r\n    },\r\n    [tombFinance, addTransaction],\r\n  );\r\n  const isBondRedeemable = useMemo(() => cashPrice.gt(BOND_REDEEM_PRICE_BN), [cashPrice, slowRefresh]);\r\n  const isBondPurchasable = useMemo(() => Number(bondStat?.tokenInFtm) < 1.01, [bondStat, slowRefresh]);\r\n\r\n  return (\r\n    <Switch>\r\n      <Page>\r\n        <BackgroundImage />\r\n        {!!account ? (\r\n          <>\r\n            <Typography color=\"textPrimary\" align=\"center\" variant=\"h3\" gutterBottom>\r\n              Bonds\r\n            </Typography>\r\n            <Route exact path={path}>\r\n              <PageHeader icon={'🏦'} subtitle=\"Earn premiums upon redemption\" />\r\n            </Route>\r\n            <StyledBond>\r\n              <StyledCardWrapper>\r\n                <ExchangeCard\r\n                  action=\"Purchase\"\r\n                  fromToken={tombFinance.TOMB}\r\n                  fromTokenName=\"GAME\"\r\n                  toToken={tombFinance.HODL}\r\n                  toTokenName=\"HODL\"\r\n                  priceDesc={\r\n                    !isBondPurchasable\r\n                      ? 'GAME is over peg'\r\n                      : getDisplayBalance(bondsPurchasable, 18, 4) + ' HODL available for purchase.'\r\n                  }\r\n                  onExchange={handleBuyBonds}\r\n                  disabled={!bondStat || isBondRedeemable}\r\n                />\r\n              </StyledCardWrapper>\r\n              <StyledStatsWrapper>\r\n                <ExchangeStat\r\n                    tokenName=\"GAME\"\r\n                    description=\"GAME Price (TWAP)\"\r\n                    price={getDisplayBalance(cashPrice, 18, 4)}\r\n                />\r\n                <Spacer size=\"md\" />\r\n                <ExchangeStat\r\n                  tokenName=\"HODL\"\r\n                  description=\"Current Price (Current GAME Price + Premium)\"\r\n                  price={Number(bondStat?.tokenInFtm).toFixed(2) || '-'}\r\n                />\r\n              </StyledStatsWrapper>\r\n              <StyledCardWrapper>\r\n                <ExchangeCard\r\n                  action=\"Redeem\"\r\n                  fromToken={tombFinance.HODL}\r\n                  fromTokenName=\"HODL\"\r\n                  toToken={tombFinance.TOMB}\r\n                  toTokenName=\"GAME\"\r\n                  priceDesc={`${getDisplayBalance(bondBalance)} HODL Available in wallet.` + (isBondRedeemable ? + ` ${rebateStats.tombAvailable.toFixed(4)} GAME available for purchase with ${rebateStats.maxBondSell.toFixed(4)} HODL. Current bonus rate is +${(rebateStats.bondBonus * 100 - 100).toFixed(2)}%.` : \"\")}\r\n                  onExchange={handleRedeemBonds}\r\n                  disabled={!bondStat || bondBalance.eq(0) || rebateStats.maxBondSellBN.eq(0) || !isBondRedeemable}\r\n                  disabledDescription={!isBondRedeemable ? `Enabled when GAME > ${BOND_REDEEM_PRICE} DAI` : null}\r\n                  max={rebateStats.maxBondSellBN}\r\n                />\r\n              </StyledCardWrapper>\r\n            </StyledBond>\r\n          </>\r\n        ) : (\r\n          <UnlockWallet />\r\n        )}\r\n      </Page>\r\n    </Switch>\r\n  );\r\n};\r\n\r\nconst StyledBond = styled.div`\r\n  display: flex;\r\n  background: transparent;\r\n  @media (max-width: 768px) {\r\n    width: 100%;\r\n    flex-flow: column nowrap;\r\n    align-items: center;\r\n  }\r\n`;\r\n\r\nconst StyledCardWrapper = styled.div`\r\n  display: flex;\r\n  flex: 1;\r\n  background: transparent;\r\n  flex-direction: column;\r\n  @media (max-width: 768px) {\r\n    width: 80%;\r\n  }\r\n`;\r\n\r\nconst StyledStatsWrapper = styled.div`\r\n  display: flex;\r\n  flex: 0.8;\r\n  margin: 0 20px;\r\n  background: transparent;\r\n  flex-direction: column;\r\n\r\n  @media (max-width: 768px) {\r\n    width: 80%;\r\n    margin: 16px 0;\r\n  }\r\n`;\r\n\r\nexport default Pit;\r\n"],"sourceRoot":""}